<main class="tabla-asistencias" aria-labelledby="asistencia-title">
  <h1><img src="/icons/pencil.svg" alt="" height="40px" width="40px"> Asistencias</h1>
  @if (mostrarFormularioCarga) {
  <div class="asistencia-control">
    @if (!isUploadProcessStarted) {
    <section aria-labelledby="filter-section-title" class="filter-section">
      <h3 id="filter-section-title" class="visually-hidden">Opciones de Filtrado</h3>
      <select id="filtro-carrera" class="form-select"
        aria-label="Filtrar asistencias por carrera, materia, curso, comisión, fecha o turno">
        <option value="" selected disabled>Seleccione una opción</option>
        <option value="carrera">Carrera</option>
        <option value="materias">Materias</option>
        <option value="curso">Curso</option>
        <option value="comision">Comisión</option>
        <option value="fecha">Fecha</option>
        <option value="turno">Turno</option>
      </select>

      <div class="centrar-boton">
        <button type="button" class="button-asistencia" (click)="iniciarProceso()">
          Subir Asistencia
        </button>
      </div>
    </section>
    }

    @if (isUploadProcessStarted) {
    <section class="asistencia-form-section" aria-labelledby="upload-section-title">
      <h2 id="upload-section-title" class="subtitle-asistencia">Subir Archivo de Asistencia</h2>
      <div class="file-upload-container">
        <label for="fileInput" class="file-upload-label">
          <span class="file-upload-icon">📁</span>
          <span class="file-upload-text">Seleccionar Archivo CSV o XLSX</span>
          <input type="file" id="fileInput" (change)="onFileSelected($event)" accept=".csv, .xlsx"
            aria-describedby="file-upload-info" aria-label="Seleccionar archivo de asistencia">
        </label>
        <div id="file-upload-info" class="file-upload-info" role="status">
          @if (archivoSeleccionado) {
          Archivo seleccionado: <strong>{{ archivoSeleccionado.name }}</strong>
          } @else if (!mensajeErrorArchivo) {
          No hay archivo seleccionado.
          }
        </div>

        @if (mensajeErrorArchivo) {
        <p class="error-message" role="alert" aria-live="polite">
          {{ mensajeErrorArchivo }}
        </p>
        }

        <button type="button" class="button-asistencia" (click)="CargarArchivo()" [disabled]="!archivoSeleccionado">
          Cargar Asistencia
        </button>
      </div>
    </section>
    }
  </div>
  } @else {
  <section class="report-preview-section" aria-labelledby="report-section-title">
    <h2 id="report-section-title" class="subtitle-asistencia">Previsualización del Informe de Asistencia</h2>

    <div class="table-responsive">
      <table class="table" aria-label="Tabla de previsualización del informe de asistencia">
        <thead>
          <tr>
            <th class="title-table contenido" scope="col">Nombre del Alumno</th>
            <th class="title-table contenido" scope="col">Estado</th>
            <th class="title-table contenido" scope="col">Fecha</th>
            <th class="title-table contenido" scope="col">Correo</th>
          </tr>
        </thead>
        <tbody>
          @for (registro of informeAsistencia; track registro.nombreAlumno) {
          <tr class="contenido">
            <td class="text-table text">{{ registro.nombreAlumno }}</td>
            <td class="text-table text">{{ registro.estado }}</td>
            <td class="text-table text">{{ registro.fecha }}</td>
            <td class="text-table text">{{ registro.correo }}</td>
          </tr>
          }
        </tbody>
      </table>
    </div>
    <div class="centrar-boton">
      <button type="button" class="button-asistencia" (click)="volverACargarArchivo()">
        Volver a Cargar Archivo
      </button>
    </div>
  </section>
  }

  <section class="asistencias-registradas" aria-labelledby="registered-attendances-title">
    <!-- <h2 id="registered-attendances-title" class="subtitle-asistencia">Asistencias Registradas:</h2> -->
    <div class="table-responsive">
      <table class="table" aria-label="Asistencias registradas">
        <thead>
          <tr>
            <th class="title-table contenido" scope="col">Carrera</th>
            <th class="title-table contenido" scope="col">Materia</th>
            <th class="title-table contenido" scope="col">Fecha</th>
            <th class="title-table contenido" scope="col">Curso</th>
            <th class="title-table contenido" scope="col">Comisión</th>
            <th class="title-table contenido" scope="col">Acciones</th>
          </tr>
        </thead>
        <tbody>
          @for (asistencia of asistenciasRegistradas; track asistencia.carrera + asistencia.materia +
          asistencia.fecha) {
          <tr class="contenido">
            <td class="text-table text">{{ asistencia.carrera }}</td>
            <td class="text-table text">{{ asistencia.materia }}</td>
            <td class="text-table text">{{ asistencia.fecha }}</td>
            <td class="text-table text">{{ asistencia.curso }}</td>
            <td class="text-table text">{{ asistencia.comision }}</td>
            <td>
              <button type="button" class="btn btn-primary" (click)="editarAsistencia(asistencia)">
                Editar
              </button>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </section>
</main> 
<!-- <main class="tabla-asistencias" aria-labelledby="asistencia-title">

  @if (mostrarFormularioCarga) {
  Contenedor para el select de filtro y el botón "Subir Asistencia (CSV/XLSX)" -->
  <!-- Visible solo en el estado inicial antes de iniciar la carga del archivo 
  @if (!isUploadProcessStarted) {
  <div class="asistencia-control">
     Sección del filtro 
    <section aria-labelledby="filter-section-title" class="filter-section">
      <h3 id="filter-section-title" class="visually-hidden">Opciones de Filtrado</h3>
      <select id="filtro-carrera" class="form-select"
        aria-label="Filtrar asistencias por carrera, materia, curso, comisión, fecha o turno">
        <option value="" selected disabled>Seleccione una opción</option>
        <option value="carrera">Carrera</option>
        <option value="materias">Materias</option>
        <option value="curso">Curso</option>
        <option value="comision">Comisión</option>
        <option value="fecha">Fecha</option>
        <option value="turno">Turno</option>
      </select>

      <div class="centrar-boton">
        <button type="button" class="button-asistencia" (click)="iniciarProceso()">
          Subir Asistencia
        </button>
      </div>
    </section>
    }
    
     Sección del formulario de carga de archivo (título, input, botón Cargar Asistencia) -->
    <!-- Visible solo después de hacer clic en "Subir Asistencia (CSV/XLSX)" 
    @if (isUploadProcessStarted) {
    <section class="asistencia-form-section" aria-labelledby="upload-section-title">
      <h2 id="upload-section-title" class="subtitle-asistencia">Subir Archivo de Asistencia</h2>
      <div class="file-upload-container">
        <label for="fileInput" class="file-upload-label">
          <span class="file-upload-icon">📁</span>
          <span class="file-upload-text">Seleccionar Archivo CSV o XLSX</span>
          <input type="file" id="fileInput" (change)="onFileSelected($event)" accept=".csv, .xlsx"
            aria-describedby="file-upload-info" aria-label="Seleccionar archivo de asistencia">
        </label>
        <div id="file-upload-info" class="file-upload-info" role="status">
          @if (archivoSeleccionado) {
          Archivo seleccionado: <strong>{{ archivoSeleccionado.name }}</strong>
          } @else if (!mensajeErrorArchivo) {
          No hay archivo seleccionado.
          }
        </div>

        @if (mensajeErrorArchivo) {
        <p class="error-message" role="alert" aria-live="polite">
          {{ mensajeErrorArchivo }}
        </p>
        }

        <button type="button" class="button-asistencia" (click)="CargarArchivo()" [disabled]="!archivoSeleccionado">
          Cargar Asistencia
        </button>
      </div>
    </section>
    }
    } @else {
    Sección de previsualización del informe de asistencia (visible solo después de cargar el archivo) 
    <section class="report-preview-section" aria-labelledby="report-section-title">
      <h2 id="report-section-title" class="subtitle-asistencia">Previsualización del Informe de Asistencia</h2>

      <div class="table-responsive">
        <table class="table" aria-label="Tabla de previsualización del informe de asistencia">
          <thead>
            <tr>
              <th class="title-table contenido" scope="col">Nombre del Alumno</th>
              <th class="title-table contenido" scope="col">Estado</th>
              <th class="title-table contenido" scope="col">Fecha</th>
              <th class="title-table contenido" scope="col">Correo</th>
            </tr>
          </thead>
          <tbody>
            @for (registro of informeAsistencia; track registro.nombreAlumno) {
            <tr class="contenido">
              <td class="text-table text">{{ registro.nombreAlumno }}</td>
              <td class="text-table text">{{ registro.estado }}</td>
              <td class="text-table text">{{ registro.fecha }}</td>
              <td class="text-table text">{{ registro.correo }}</td>
            </tr>
            }
          </tbody>
        </table>
      </div>
      <div class="centrar-boton">
        <button type="button" class="button-asistencia" (click)="volverACargarArchivo()">
          Volver a Cargar Archivo
        </button>
      </div>
    </section>
    }

    Sección de asistencias registradas (esta tabla de historial SIEMPRE es visible) 
    <section class="asistencias-registradas" aria-labelledby="registered-attendances-title">
      <h2 id="registered-attendances-title" class="subtitle-asistencia">Asistencias Registradas:</h2>
      <div class="table-responsive">
        <table class="table" aria-label="Asistencias registradas">
          <thead>
            <tr>
              <th class="title-table contenido" scope="col">Carrera</th>
              <th class="title-table contenido" scope="col">Materia</th>
              <th class="title-table contenido" scope="col">Fecha</th>
              <th class="title-table contenido" scope="col">Curso</th>
              <th class="title-table contenido" scope="col">Comisión</th>
              <th class="title-table contenido" scope="col">Acciones</th>
            </tr>
          </thead>
          <tbody>
            @for (asistencia of asistenciasRegistradas; track asistencia.carrera + asistencia.materia +
            asistencia.fecha) {
            <tr class="contenido">
              <td class="text-table text">{{ asistencia.carrera }}</td>
              <td class="text-table text">{{ asistencia.materia }}</td>
              <td class="text-table text">{{ asistencia.fecha }}</td>
              <td class="text-table text">{{ asistencia.curso }}</td>
              <td class="text-table text">{{ asistencia.comision }}</td>
              <td>
                <button type="button" class="btn btn-primary" (click)="editarAsistencia(asistencia)">
                  Editar
                </button>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </section>
</main> -->